\documentclass{article}
    \pagestyle{empty}
\usepackage[landscape]{geometry}
\usepackage{ragged2e}
\usepackage{pgfplots}
    \pgfplotsset{compat=newest}
    \usepgfplotslibrary{fillbetween}
\usepackage{xstring}
\usepackage{underscore}

\begin{document}

\begin{figure}[!h]
    \Centering]
\begin{tikzpicture}
\begin{axis}[xlabel=train\_batch, ylabel=loss, no marks]
    \addplot table [x=train_batch, y=train_loss] {\logpath};
    \addlegendentry{train}
    \addplot table [x=train_batch, y=val_loss] {\logpath};
    \addlegendentry{val}
\end{axis}
\end{tikzpicture}
\end{figure}

\pgfplotstableread{\logpath}{\log}
\pgfplotstablegetcolsof{\log}
\def\offset{3}
\def\grouplen{8}
\pgfmathtruncatemacro{\maxgroupindex}{((\pgfplotsretval-\offset)/\grouplen)-1}

\foreach \groupindex in {0,...,\maxgroupindex}{
    \pgfmathtruncatemacro{\gradmeanindex}{\offset+\groupindex*\grouplen}
    \pgfmathtruncatemacro{\gradtopindex}{\gradmeanindex+1}
    \pgfmathtruncatemacro{\gradbotindex}{\gradmeanindex+2}
    \pgfmathtruncatemacro{\gradmaxindex}{\gradmeanindex+3}
    
    \pgfmathtruncatemacro{\datameanindex}{\gradmeanindex+4}
    \pgfmathtruncatemacro{\datatopindex}{\gradmeanindex+5}
    \pgfmathtruncatemacro{\databotindex}{\gradmeanindex+6}
    \pgfmathtruncatemacro{\datamaxindex}{\gradmeanindex+7}

    \pgfplotstablegetcolumnnamebyindex{\gradmeanindex}\of{\log}\to{\gradmeanname}
    \pgfplotstablegetcolumnnamebyindex{\gradtopindex}\of{\log}\to{\gradtopname}
    \pgfplotstablegetcolumnnamebyindex{\gradbotindex}\of{\log}\to{\gradbotname}
    \pgfplotstablegetcolumnnamebyindex{\gradmaxindex}\of{\log}\to{\gradmaxname}

    \pgfplotstablegetcolumnnamebyindex{\datameanindex}\of{\log}\to{\datameanname}
    \pgfplotstablegetcolumnnamebyindex{\datatopindex}\of{\log}\to{\datatopname}
    \pgfplotstablegetcolumnnamebyindex{\databotindex}\of{\log}\to{\databotname}
    \pgfplotstablegetcolumnnamebyindex{\datamaxindex}\of{\log}\to{\datamaxname}
    
    \clearpage
    
    \begin{Center}
        \textbf{\Large \StrBefore{\gradmeanname}{.grad_mean}}
    \end{Center}
    
    \begin{figure}[!h]
    \Centering
        \begin{tikzpicture}
        \begin{axis}[xlabel=train_batch, ylabel=grad, no marks, scale=0.8]
            \addplot table [x=train_batch, y index=\gradmeanindex] {\logpath};
            \pgfplotsset{cycle list shift=-1}
            \addplot+[name path=top, opacity=0, forget plot] table [x=train_batch, y index=\gradtopindex] {\logpath};
            \addplot+[name path=bot, opacity=0, forget plot] table [x=train_batch, y index=\gradbotindex] {\logpath};
            \addplot+[opacity=3/8, forget plot] fill between [of=top and bot];
            \pgfplotsset{cycle list shift=0}
        \end{axis}
        \end{tikzpicture}
        %
        \begin{tikzpicture}
        \begin{axis}[xlabel=train_batch, ylabel=grad_max, no marks, scale=0.8]
            \addplot table [x=train_batch, y index=\gradmeanindex] {\logpath};
        \end{axis}
        \end{tikzpicture}
    \end{figure}

    \begin{figure}[!h]
    \Centering
        \begin{tikzpicture}
        \begin{axis}[xlabel=train_batch, ylabel=data, no marks, scale=0.8]
            \addplot table [x=train_batch, y index=\datameanindex] {\logpath};
            \pgfplotsset{cycle list shift=-1}
            \addplot+[name path=top, opacity=0, forget plot] table [x=train_batch, y index=\datatopindex] {\logpath};
            \addplot+[name path=bot, opacity=0, forget plot] table [x=train_batch, y index=\databotindex] {\logpath};
            \addplot+[opacity=3/8, forget plot] fill between [of=top and bot];
            \pgfplotsset{cycle list shift=0}
        \end{axis}
        \end{tikzpicture}
        %
        \begin{tikzpicture}
        \begin{axis}[xlabel=train_batch, ylabel=data_max, no marks, scale=0.8]
            \addplot table [x=train_batch, y index=\datamaxindex] {\logpath};
        \end{axis}
        \end{tikzpicture}  
    \end{figure}
}

\end{document}
